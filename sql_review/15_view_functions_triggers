---------------------------------------------------
CHAPTER 15 - VIEWS, FUNCTIONS, and TRIGGERS
---------------------------------------------------

- Using Views to Simplify Queries

    A 'view' is a virtual table we can create dynamically using a saved query.  Every time
      we access the view, the saved query runs automatically and displays the results.
      We can query a view, join it to regular tables or other views, and used it to
      update or insert data to the table it's based on.

    Views are used to:
      - Avoid duplicate effort
      - Reduce complexity
      - Provide security by limiting access to certain columns in a table



- Creating and Querying a View

    # Create a view
    CREATE OR REPLACE VIEW nevada_counties_pop_2010 AS
        SELECT geo_name,
             state_fips,
             county_fips,
             p0010001 AS pop_2010
        FROM us_counties_2010
        WHERE state_us_abbreviation = 'NV'
        ORDER BY county_fips;


    # Query the view
    SELECT *
    FROM nevada_counties_pop_2010
    LIMIT 5;



- Inserting, Updating, and Deleting Data with Views

    # Create a view
    CREATE OR REPLACE VIEW employees_tax_dept AS
        SELECT emp_id,
            first_name,
            last_name,
            dept_id
        FROM employees
        WHERE dept_id = 1
        ORDER BY emp_id
    WITH LOCAL CHECK OPTION;


    The WITH LOCAL CHECK OPTION rejects any insert or update that does not meet the criteria of
      the WHERE clause.  For example, the option won't allow a row to be updated or inserted
      if the employee's 'dept_id' is 3.


    # Will insert row successfully using the view
    INSERT INTO employees_tax_dept (first_name, last_name, dept_id)
    VALUES ('Suzanne', 'Legere', 1);


    # Will fail since dept_id isn't 1
    INSERT INTO employees_tax_dept (first_name, last_name, dept_id)
    VALUES ('Jamil', 'White', 2);


    # Update row using view
    UPDATE employees_tax_dept
    SET last_name = 'Le Gere'
    WHERE emp_id = 5;


    # Delete row using view
    DELETE FROM employees_tax_dept
    WHERE emp_id = 5;